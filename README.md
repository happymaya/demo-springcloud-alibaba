# demo-springcloud-alibaba
SpringCloud Alibaba 套件落地实践

## 微服务架构的演进过程
### 单体架构设计图
![单体架构设计图](./illustration/Monomer%20architecture.png)
- 优点：开发、部署、上线简单；
- 缺点：代码耦合严重、牵一发而动全身

### 单体架构的升级改进：垂直应用架构

> 垂直：单一的业务场景，例如：电商、外卖、音乐等等
{: .prompt-tip }

![垂直应用架构设计图](./illustration/vertical.png)

- 优点：服务、部署独立，水平扩展容易；
- 缺点：搭建复杂、服务之间关系错综复杂、维护困难

### 垂直应用架构的升级改进：SOA 架构
![SOA 架构设计图](./illustration/soa.png)


## 业界最流行的软件开发架构：微服务架构
![微服务架构设计图](./illustration/micro-service.png)

## 微服务架构遵循的原则


  - 合理、正确的将单体应用迁移到微服务（收益或优点）
    - 单个的微服务，可选择任意一个擅长的语言去开发、扩展性强
    - 对整个应用而言，代码不耦合，不会出现大量的冲突
    - 微服务可以重用，应用发布时间可控性更强
    - 通过故障隔离，让错误在微服务中降级，不会影响到整个应用（或其他服务）

### 不遵循微服务架构原则带来的问题

1. 微服务之间的依赖错综复杂（功能业务划分的不合理,存在大量交叉点），难以维护；
2. 开发过程【互相纠缠】，开发、上线时间严重影响
![不遵循微服务架构原则带来的巨大问题](./illustration/micro-service-weakness.png)

### 微服务架构需要遵循的原则

最佳实践：
1. 职责独立：每个微服务只做自己功能范围内的事情，微服务之间的依赖链不要【过长】
  ![不遵循微服务架构原则带来的巨大问题](./illustration/micro-service-yuanze.png) 
  > 建议单个微服务的依赖链路不要超过 3

  > 微服务的通信链路如果【太长】，就需要考虑重构，重新拆分微服务

  > 对通用的功能逻辑，如果不经常变更，做成 SDK，而不是一个服务

2. 使用熔断实现快速的故障容错和线程隔离，例如：`Hystrix`、`Sentinel`
3. 通过网关代理微服务请求，网关是微服务架构对外暴露的唯一入口
   ![](./illustration/micro-service-gateway.png)
4. 确保微服务 API 变更后能够向后兼容

正确、合理的使用微服务会带来收益和成本的节省。如果前期不做优良的设计，成效差强人意。因此，在做微服务应用之前先不着急写代码，做实施，先将要做的事情、依赖、中间件以及工具梳理好，这是写出好代码、好的微服务架构设计（有可能）！


## 领域驱动设计（DDD）

DDD 相关概念：
- DDD 是一种软件架构设计方法，它并不定义软件开发过程（DevOps）
  ![](./illustration/ddd-domain.png)
- DDD 利用面向对象的特性，以业务为核心驱动，而不是传统的数据库（表）驱动开发


领域：
- 领域是对功能需求的划分；大的领域下面还有许多小的子领域（理解领域，对功能需求、业务场景的理解）


领域建模：
- 分析领域模型，推演**实体**、**值对象**、**领域服务**
- 找出聚合边界（降低服务耦合）
- 为聚合配备存储仓库（数据持久化）
- 实践 DDD，不断推到和重构
